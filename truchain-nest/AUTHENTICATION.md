# TruChain Authentication Guide

TruChain offers two simple authentication methods:

1. **Server Authentication** - For API clients and server-to-server communication
2. **Wallet Authentication** - For UI users with wallet extensions

## Server Authentication

This method is designed for server-to-server API calls where you have a private key generated by TruChain.

### Endpoint: `POST /auth/server`

**Request Body:**
```json
{
  "address": "0x1234567890abcdef1234567890abcdef12345678",
  "privateKey": "0x1234567890abcdef1234567890abcdef1234567890abcdef1234567890abcdef"
}
```

**Response:**
```json
{
  "accessToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "address": "0x1234567890abcdef1234567890abcdef12345678",
  "expiresAt": 1695146189123
}
```

### Example (Node.js):

```javascript
const axios = require('axios');

async function authenticateServer() {
  const response = await axios.post('https://api.truchain.com/auth/server', {
    address: '0x1234567890abcdef1234567890abcdef12345678',
    privateKey: '0x1234567890abcdef1234567890abcdef1234567890abcdef1234567890abcdef'
  });
  
  const { accessToken } = response.data;
  
  // Use the token for subsequent API calls
  return accessToken;
}
```

## Wallet Authentication

This method is designed for UI users who have wallet extensions (MetaMask, etc.).

### Endpoint: `POST /auth/wallet`

**Request Body:**
```json
{
  "address": "0x1234567890abcdef1234567890abcdef12345678",
  "signature": "0x1234567890abcdef1234567890abcdef1234567890abcdef1234567890abcdef1234567890abcdef1234567890abcdef1234567890abcdef1234567890abcdef1c"
}
```

**Response:**
```json
{
  "accessToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "address": "0x1234567890abcdef1234567890abcdef12345678",
  "expiresAt": 1695146189123
}
```

### Example (Web3.js + React):

```javascript
import Web3 from 'web3';
import axios from 'axios';

async function authenticateWithWallet() {
  // Connect to the user's wallet
  const web3 = new Web3(window.ethereum);
  await window.ethereum.enable();
  
  const accounts = await web3.eth.getAccounts();
  const address = accounts[0];
  
  // Message to sign is always the same
  const message = "Sign to authenticate with TruChain";
  
  // Request signature from the wallet
  const signature = await web3.eth.personal.sign(message, address, '');
  
  // Send the address and signature to the server
  const response = await axios.post('https://api.truchain.com/auth/wallet', {
    address,
    signature
  });
  
  const { accessToken } = response.data;
  
  // Store the token for subsequent API calls
  localStorage.setItem('truchain_token', accessToken);
  
  return accessToken;
}
```

## Using the JWT Token

After authentication, include the JWT token in the Authorization header for all API requests:

```javascript
axios.get('https://api.truchain.com/api/endpoint', {
  headers: {
    'Authorization': `Bearer ${accessToken}`
  }
});
```

## Security Considerations

1. **Server Authentication**:
   - Keep your private key secure and never expose it in client-side code
   - Rotate your private key periodically
   - Use HTTPS for all API calls

2. **Wallet Authentication**:
   - The signature is only valid for the specific message "Sign to authenticate with TruChain"
   - Always verify the message before signing with your wallet
   - The JWT token has an expiration time, after which you'll need to re-authenticate
